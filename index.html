<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>სათევზაო ამინდის პროგნოზი</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    .fishing-good { background-color: #10b981; }
    .fishing-moderate { background-color: #f59e0b; }
    .fishing-poor { background-color: #ef4444; }
    .tab-active { background-color: #2dd4bf; color: white; }
    .tab-inactive { background-color: #4b5563; color: white; }
    .tab-inactive:hover { background-color: #5eead4; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .tab-transition { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); }
  </style>
</head>
<body class="bg-gradient-to-b from-blue-900 to-slate-800 min-h-screen flex items-center justify-center p-4 font-sans">
  <div class="container mx-auto max-w-4xl">
    <h1 class="text-3xl font-bold text-center mb-6 text-white">სათევზაო ამინდის პროგნოზი</h1>
    
    <!-- Tab Navigation -->
    <div class="flex justify-center mb-6">
      <div class="flex space-x-2 bg-slate-700 rounded-lg p-1">
        <button class="tab-button tab-active px-4 py-2 rounded-md font-medium tab-transition" data-location="თბილისი"><i class="fa-solid fa-location-dot mr-2"></i>თბილისი</button>
        <button class="tab-button tab-inactive px-4 py-2 rounded-md font-medium tab-transition" data-location="სიონი"><i class="fa-solid fa-location-dot mr-2"></i>სიონი</button>
        <button class="tab-button tab-inactive px-4 py-2 rounded-md font-medium tab-transition" data-location="წალკა"><i class="fa-solid fa-location-dot mr-2"></i>წალკა</button>
        <button class="tab-button tab-inactive px-4 py-2 rounded-md font-medium tab-transition" data-location="ნადარბაზევი"><i class="fa-solid fa-location-dot mr-2"></i>ნადარბაზევი</button>
        <button class="tab-button tab-inactive px-4 py-2 rounded-md font-medium tab-transition" data-location="ბაზალეთი"><i class="fa-solid fa-location-dot mr-2"></i>ბაზალეთი</button>
      </div>
    </div>

    <!-- Weather Container -->
    <div id="weather-container" class="bg-white rounded-lg shadow-xl p-6"></div>
  </div>

  <script>
    const locations = [
      { name: "თბილისი", lat: 41.7151, lon: 44.8271 },
      { name: "სიონი", lat: 41.9892, lon: 44.5744 },
      { name: "წალკა", lat: 41.5946, lon: 44.0895 },
      { name: "ნადარბაზევი", lat: 41.9833, lon: 44.3333 },
      { name: "ბაზალეთი", lat: 41.9961, lon: 44.6789 }
    ];

    async function fetchWeatherData(lat, lon) {
      // Placeholder for Yr.no API
      try {
        // Mock response for demonstration
        const response = {
          data: {
            properties: {
              timeseries: Array(7).fill().map((_, i) => ({
                time: new Date(Date.now() + i * 24 * 60 * 60 * 1000).toISOString(),
                data: {
                  instant: {
                    details: {
                      air_temperature: 15 + Math.random() * 10,
                      wind_speed: 5 + Math.random() * 15,
                      precipitation_amount: Math.random() * 5,
                      cloud_area_fraction: 20 + Math.random() * 60
                    }
                  }
                }
              }))
            }
          }
        };
        return response.data.properties.timeseries;
      } catch (error) {
        console.error("შეცდომა ამინდის მონაცემების მიღებისას:", error);
        return [];
      }
    }

    function getFishingCondition(temp, wind, precip) {
      if (temp >= 10 && temp <= 25 && wind >= 5 && wind <= 15 && precip < 2) {
        return { 
          status: "კარგი", 
          class: "fishing-good", 
          icon: "fa-fish", 
          reason: "იდეალური ტემპერატურა, ზომიერი ქარი, მინიმალური ნალექი" 
        };
      } else if (
        ((temp >= 5 && temp < 10) || (temp > 25 && temp <= 30)) ||
        (wind > 15 && wind <= 25) ||
        (precip >= 2 && precip <= 5)
      ) {
        return { 
          status: "საშუალო", 
          class: "fishing-moderate", 
          icon: "fa-fish", 
          reason: "ტემპერატურა ან ქარი ნაკლებად იდეალურია, შესაძლოა ზომიერი ნალექი" 
        };
      } else {
        return { 
          status: "ცუდი", 
          class: "fishing-poor", 
          icon: "fa-fish", 
          reason: "ძალიან ცივი ან ცხელი, ძლიერი ქარი ან ნალექი" 
        };
      }
    }

    function getWeatherIcon(cloudCover, precip) {
      if (precip > 2) return "fa-cloud-rain";
      if (cloudCover > 70) return "fa-cloud";
      if (cloudCover > 30) return "fa-cloud-sun";
      return "fa-sun";
    }

    async function renderWeather(locationName) {
      const container = document.getElementById("weather-container");
      container.innerHTML = "";
      const location = locations.find(loc => loc.name === locationName);
      if (!location) return;

      const forecast = await fetchWeatherData(location.lat, location.lon);
      let html = `<div class="tab-content active">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4"><i class="fa-solid fa-map-marker-alt mr-2"></i>${location.name}</h2>
        <div class="space-y-4">
      `;

      forecast.forEach(day => {
        const date = new Date(day.time).toLocaleDateString("ka-GE", { weekday: "short", month: "short", day: "numeric" });
        const temp = day.data.instant.details.air_temperature;
        const wind = day.data.instant.details.wind_speed;
        const precip = day.data.instant.details.precipitation_amount;
        const clouds = day.data.instant.details.cloud_area_fraction;
        const fishing = getFishingCondition(temp, wind, precip);
        const weatherIcon = getWeatherIcon(clouds, precip);

        html += `
          <div class="flex items-center justify-between p-4 rounded-lg ${fishing.class} text-white shadow-md card-hover tab-transition">
            <div class="flex items-center space-x-4">
              <i class="fa-solid ${weatherIcon} text-2xl"></i>
              <div>
                <p class="font-medium">${date}</p>
                <p>ტემპერატურა: ${temp.toFixed(1)}°C</p>
                <p>ქარი: ${wind.toFixed(1)} კმ/სთ</p>
                <p>ნალექი: ${precip.toFixed(1)} მმ</p>
                <p>ღრუბლიანობა: ${clouds.toFixed(0)}%</p>
              </div>
            </div>
            <div class="text-right">
              <p class="font-bold"><i class="fa-solid ${fishing.icon} mr-2"></i>თევზაობა: ${fishing.status}</p>
              <p class="text-sm">${fishing.reason}</p>
            </div>
          </div>
        `;
      });

      html += `</div></div>`;
      container.innerHTML = html;
    }

    // Tab switching logic
    const tabButtons = document.querySelectorAll(".tab-button");
    tabButtons.forEach(button => {
      button.addEventListener("click", () => {
        tabButtons.forEach(btn => {
          btn.classList.remove("tab-active");
          btn.classList.add("tab-inactive");
        });
        button.classList.remove("tab-inactive");
        button.classList.add("tab-active");
        renderWeather(button.dataset.location);
      });
    });

    // Initial render
    renderWeather("თბილისი");

    // Auto-update every hour
    setInterval(() => renderWeather(document.querySelector(".tab-active").dataset.location), 60 * 60 * 1000);
  </script>
</body>
</html>
