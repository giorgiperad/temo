<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>თევზაობის ამინდის პროგნოზი</title>
    <style>
        /* Your existing styles are good and remain unchanged */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>თევზაობის ამინდის პროგნოზი</h1>
            <p>თქვენი საუკეთესო თევზაობის დღეების დამგეგმავი</p>
        </div>

        <select id="location-select" class="location-select">
            <option value="tbilisi">თბილისი</option>
            <option value="sioni">სიონი</option>
            <option value="tsalka">წალკა</option>
            <option value="bazaleti">ბაზალეთი</option>
            <option value="nadarbazevi">ნადარბაზევი</option>
        </select>

        <div id="date-select" class="date-select"></div>
        <div id="forecast-container" class="forecast-container">
            <div class="loading">მონაცემების ჩატვირთვა...</div>
        </div>

        <div class="info-section">
            <h3>თევზაობის პირობების განმარტება</h3>
            <p>თევზაობისთვის საუკეთესო პირობები მოიცავს: სტაბილურ წნევას (990-1020 hPa), ტემპერატურას 15-22°C, დაბალ ქარს (<15 კმ/სთ), და მცირე ან საშუალო ღრუბლიანობას.</p>
        </div>
    </div>

    <footer>
        <p>მონაცემები განახლებულია: <span id="update-time"></span></p>
    </footer>

    <script>
    const LOCATIONS = {
        tbilisi: { name: "თბილისი", lat: 41.7151, lon: 44.8271 },
        sioni: { name: "სიონი", lat: 41.6206, lon: 44.7944 },
        tsalka: { name: "წალკა", lat: 41.5969, lon: 44.0931 },
        bazaleti: { name: "ბაზალეთი", lat: 41.9031, lon: 44.6892 },
        nadarbazevi: { name: "ნადარბაზევი", lat: 41.7756, lon: 44.7823 }
    };

    const API_KEY = 'b5f3b44e0ff36c689aa09e1c5f227d6d'; // <- Replace this with your actual key
    let weatherData = [];
    const startDate = new Date();

    async function fetchWeatherData(location) {
        const { lat, lon } = LOCATIONS[location];
        const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}`;
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error("API Error: " + response.status);
            const data = await response.json();
            return data.list.map(item => {
                const date = new Date(item.dt * 1000);
                return {
                    date,
                    hour: date.getHours(),
                    temperature: item.main.temp,
                    windSpeed: item.wind.speed,
                    windDirection: item.wind.deg,
                    precipProbability: Math.round((item.pop || 0) * 100),
                    precipAmount: item.rain?.['3h'] || 0,
                    humidity: item.main.humidity,
                    cloudCover: item.clouds.all,
                    pressure: item.main.pressure,
                    uvIndex: '-', // Removed because unavailable
                    fishingQuality: 'fair', // placeholder
                    isMajorPeriod: false,
                    isMinorPeriod: false
                }
            });
        } catch (e) {
            console.error(e);
            document.getElementById("forecast-container").innerHTML = '<div class="loading">ამინდის მონაცემების ჩატვირთვა ვერ მოხერხდა</div>';
            return [];
        }
    }

    function formatDate(date) {
        return date.toLocaleDateString('ka-GE', { weekday: 'long', day: 'numeric', month: 'long' });
    }

    function formatTime(date) {
        return date.toLocaleTimeString('ka-GE', { hour: '2-digit', minute: '2-digit', hour12: false });
    }

    function renderDayForecast(dayIndex) {
        const container = document.getElementById('forecast-container');
        const selectedDate = new Date(startDate);
        selectedDate.setDate(startDate.getDate() + dayIndex);
        const data = weatherData.filter(item => {
            const d = new Date(item.date);
            return d.getDate() === selectedDate.getDate();
        });
        if (!data.length) {
            container.innerHTML = '<div class="loading">ამინდის მონაცემები არ მოიძებნა</div>';
            return;
        }
        let html = `<div class="current-conditions">
            <h2>${formatDate(selectedDate)}</h2>
            <div class="current-temp">${data[0].temperature}°C</div>
        </div><div class="hourly-forecast">`;
        data.forEach(item => {
            html += `<div class="hour-card">
                <div>${formatTime(new Date(item.date))}</div>
                <div>${item.temperature}°C</div>
                <div>${item.windSpeed} კმ/სთ</div>
                <div>${item.precipProbability}% ნალექი</div>
            </div>`;
        });
        html += '</div>';
        container.innerHTML = html;
    }

    function generateDayButtons() {
        const container = document.getElementById('date-select');
        container.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const date = new Date(startDate);
            date.setDate(startDate.getDate() + i);
            const btn = document.createElement('button');
            btn.className = 'date-btn' + (i === 0 ? ' active' : '');
            btn.setAttribute('data-day', i);
            btn.innerHTML = `${date.toLocaleDateString('ka-GE', { weekday: 'short' })}<br>${date.getDate()}`;
            btn.onclick = () => {
                document.querySelectorAll('.date-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderDayForecast(i);
            }
            container.appendChild(btn);
        }
    }

    async function loadLocationData() {
        const locationId = document.getElementById("location-select").value;
        document.getElementById("forecast-container").innerHTML = '<div class="loading">მონაცემების ჩატვირთვა...</div>';
        weatherData = await fetchWeatherData(locationId);
        generateDayButtons();
        renderDayForecast(0);
        document.getElementById('update-time').textContent = new Date().toLocaleString('ka-GE');
    }

    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("location-select").addEventListener("change", loadLocationData);
        loadLocationData();
        setInterval(() => loadLocationData(), 1800000);
    });
    </script>
</body>
</html>
